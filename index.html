<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Performance 3D Flight Visualization System</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="processing-content">
            <div class="spinner"></div>
            <p>Processing your data...</p>
            <p class="progress-text" id="progressText">Reading CSV file...</p>
            <p class="data-info" id="dataInfo" style="font-size: 12px; color: #888; margin-top: 10px;"></p>
        </div>
    </div>

    <!-- Global Reset Button -->
    <button id="globalResetBtn" class="global-reset-btn hidden" title="Reset to Initial State">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
        Reset
    </button>

    <div class="main-container" id="mainContainer">
        <!-- Data Statistics Banner -->
        <div id="dataStatsBanner" style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.8); color: white; padding: 8px 20px; border-radius: 20px; font-size: 12px; z-index: 1000; display: none; backdrop-filter: blur(10px);">
            <span id="dataStatsText"></span>
        </div>
        
        <!-- 3D Visualization Section (25%) -->
        <div class="section-3d">
            <button class="maximize-btn" data-section="3d" title="Maximize 3D Visualization">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                </svg>
            </button>
            <div id="container"></div>
            <div id="info">Albatross Flight Path Visualization</div>
            <div id="loading">Loading flight data...</div>
            
            <!-- Legend Toggle Button -->
            <button class="legend-toggle-btn" id="legendToggle">Show Legend</button>
            
            <!-- Color Legend -->
            <div class="color-legend hidden" id="colorLegend">
                <h4 id="legendTitle">Flight Path Coloring</h4>
                
                <!-- Parameter Selection -->
                <div class="parameter-selector">
                    <h5>Color Parameter</h5>
                    <div class="parameter-buttons">
                        <div class="parameter-btn active" data-parameter="altitude">Altitude</div>
                        <div class="parameter-btn" data-parameter="pressure">Pressure</div>
                        <div class="parameter-btn" data-parameter="temperature">Temperature</div>
                        <div class="parameter-btn" data-parameter="state">Flight Mode</div>
                    </div>
                </div>
                
                <div id="legendItems">
                    <!-- Legend items will be dynamically generated -->
                </div>
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #ddd; font-size: 12px; color: #666;">
                    <div id="parameterRange">Range: Loading...</div>
                </div>
            </div>
            
            <!-- Path Navigation Controls (moved here from bottom) -->
            <div class="path-navigation">
                <h3>Path Navigation</h3>
                <div class="segment-buttons" id="segmentButtons">
                    <!-- Segment buttons removed, just prev/next buttons kept -->
                </div>
                <div style="margin-top: 10px;">
                    <button id="prevSegment">‚Üê Prev</button>
                    <button id="nextSegment">Next ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Map Section (25%) -->
        <div class="section-map">
            <button class="maximize-btn" data-section="map" title="Maximize Map">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                </svg>
            </button>
            <h3>Geographic Flight Path</h3>
            <!-- Map Color Mode Toggle -->
            <div class="map-color-toggle" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 4px;">
                <button class="map-color-btn active" data-mode="altitude" title="Color by Altitude">
                    üìè Altitude
                </button>
                <button class="map-color-btn" data-mode="state" title="Color by Flight Mode">
                    ü¶Ö Flight Mode
                </button>
            </div>
            <div id="mapColorInfo" style="font-size: 9px; color: #666; text-align: center; margin-bottom: 2px; line-height: 1.2;">
                üó∫Ô∏è Real geographic location ‚Ä¢ Colors show altitude ‚Ä¢ Click markers for details
            </div>
            <div id="map"></div>
            <!-- Map Legend -->
            <div id="mapLegend" class="map-legend">
                <!-- Legend content populated by JS based on current mode -->
            </div>
        </div>
        
        <!-- Magnetometer Chart Section -->
            <div class="graph-section">
                <button class="zoom-out-btn" id="zoomOutBtn1" title="Zoom Out to Full Range" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                        <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                </button>
                <button class="maximize-btn" data-section="magnetometer" title="Maximize Magnetometer Chart">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                    </svg>
                </button>
                <div class="parameter-selector-top">
                    <label for="chart1Parameter">Parameter:</label>
                    <select id="chart1Parameter">
                        <option value="magnetometer">Magnetometer</option>
                        <option value="accelerometer">Accelerometer</option>
                        <option value="altitude">Altitude</option>
                        <option value="pressure">Pressure</option>
                        <option value="temperature">Temperature</option>
                    </select>
                </div>
                <h3 id="chart1Title">Magnetometer vs Time</h3>
                <div style="font-size: 9px; color: #888; text-align: center; margin-bottom: 5px; line-height: 1.2;">
                    üí° <strong>Tip:</strong> Click & drag to zoom in ‚Ä¢ Drag again to zoom in further ‚Ä¢ Drag selection rectangle to move along timeline ‚Ä¢ Click zoom out to reset ‚Ä¢ Syncs with 3D view & zooms map
                </div>
                <canvas id="magnetometerChart"></canvas>
            </div>
        
        <!-- Accelerometer Chart Section -->
            <div class="graph-section">
                <button class="zoom-out-btn" id="zoomOutBtn2" title="Zoom Out to Full Range" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                        <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                </button>
                <button class="maximize-btn" data-section="accelerometer" title="Maximize Accelerometer Chart">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                    </svg>
                </button>
                <div class="parameter-selector-top">
                    <label for="chart2Parameter">Parameter:</label>
                    <select id="chart2Parameter">
                        <option value="magnetometer">Magnetometer</option>
                        <option value="accelerometer" selected>Accelerometer</option>
                        <option value="altitude">Altitude</option>
                        <option value="pressure">Pressure</option>
                        <option value="temperature">Temperature</option>
                    </select>
                </div>
                <h3 id="chart2Title">Accelerometer vs Time</h3>
                <div style="font-size: 9px; color: #888; text-align: center; margin-bottom: 5px; line-height: 1.2;">
                    üí° <strong>Tip:</strong> Click & drag to zoom in ‚Ä¢ Drag again to zoom in further ‚Ä¢ Drag selection rectangle to move along timeline ‚Ä¢ Click zoom out to reset ‚Ä¢ Syncs with 3D view & zooms map
                </div>
                <canvas id="accelerometerChart"></canvas>
        </div>
    </div>

    <!-- Add tooltip div for hover information -->
    <div id="tooltip"></div>

    <!-- Trajectory Metrics Panel -->
    <div id="metricsPanel" class="metrics-panel hidden">
        <div class="metrics-header">
            <h3>üìä Trajectory Metrics</h3>
            <button class="metrics-close-btn" id="metricsCloseBtn">√ó</button>
        </div>
        <div class="metrics-content" id="metricsContent">
            <div class="metrics-loading">Computing metrics...</div>
        </div>
    </div>
    
    <!-- Metrics Toggle Button -->
    <button id="metricsToggleBtn" class="metrics-toggle-btn hidden" title="Show Trajectory Metrics">
        üìä Metrics
    </button>

    <!-- External Library Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Leaflet CSS and JS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Leaflet MarkerCluster for performance with many markers -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    
    <!-- Main Application Script -->
    <script src="js/script.js"></script>
</body>
</html> 
